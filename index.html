<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FuseSign WYSIWYG Editor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f9fb;
      margin: 20px;
      color: #333;
    }

    h1 {
      color: #004c99;
    }

    .toolbar {
      margin-bottom: 10px;
    }

    .toolbar button,
    .dropdown {
      background: #ffffff;
      border: 1px solid #d6e0f0;
      color: #004c99;
      padding: 6px 10px;
      margin-right: 5px;
      cursor: pointer;
      border-radius: 4px;
    }

    .toolbar button:hover,
    .dropdown:hover {
      background: #e6f0ff;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #ffffff;
      border: 1px solid #d6e0f0;
      padding: 5px;
      z-index: 1;
      border-radius: 4px;
    }

    .dropdown-content span {
      cursor: pointer;
      padding: 4px;
      display: inline-block;
      font-size: 18px;
    }

    .dropdown-content span:hover {
      background-color: #f1f1f1;
    }

    #editor {
      border: 1px solid #c6d4ec;
      padding: 10px;
      min-height: 150px;
      background: #ffffff;
      border-radius: 4px;
    }

    #output {
      white-space: pre-wrap;
      background: #f1f5fa;
      border: 1px solid #d6e0f0;
      padding: 10px;
      margin-top: 15px;
      border-radius: 4px;
    }

    #copyButton {
      background: #004c99;
      color: #fff;
      border: none;
      padding: 8px 12px;
      margin-top: 10px;
      cursor: pointer;
      border-radius: 4px;
    }

    #copyButton:hover {
      background: #0066cc;
    }
  </style>
</head>
<body>
  <h1>FuseSign WYSIWYG Editor</h1>
  <div class="toolbar">
    <button onclick="execCmd('bold')"><b>B</b></button>
    <button onclick="execCmd('italic')"><i>I</i></button>
    <button onclick="execCmd('underline')"><u>U</u></button>
    <button onclick="execCmd('formatBlock', 'h1')">H1</button>
    <button onclick="execCmd('formatBlock', 'h2')">H2</button>

    <div class="dropdown" onclick="toggleDropdown('symbolDropdown')">Symbols â–¼
      <div id="symbolDropdown" class="dropdown-content">
        <span onclick="insertText('â€¢')">â€¢</span>
        <span onclick="insertText('âœ”ï¸')">âœ”ï¸</span>
        <span onclick="insertText('âœ˜')">âœ˜</span>
        <span onclick="insertText('âœ')">âœ</span>
        <span onclick="insertText('âœ')">âœ</span>
        <span onclick="insertText('â—¦')">â—¦</span>
      </div>
    </div>

    <div class="dropdown" onclick="toggleDropdown('emojiDropdown')">ğŸ˜Š Emoji â–¼
      <div id="emojiDropdown" class="dropdown-content">
        <span onclick="insertText('ğŸ˜€')">ğŸ˜€</span>
        <span onclick="insertText('ğŸ˜‚')">ğŸ˜‚</span>
        <span onclick="insertText('ğŸ˜')">ğŸ˜</span>
        <span onclick="insertText('ğŸ‘')">ğŸ‘</span>
        <span onclick="insertText('ğŸ‰')">ğŸ‰</span>
        <span onclick="insertText('ğŸ’¡')">ğŸ’¡</span>
      </div>
    </div>

    <button onclick="clearFormatting()">Clear</button>
  </div>

  <div id="editor" contenteditable="true" oninput="updateOutput()"></div>

  <button id="copyButton" onclick="copyToClipboard()">Copy for FuseSign</button>

  <h3>HTML Output:</h3>
  <div id="output"></div>

  <script>
    let savedRange = null;

    function execCmd(command, value = null) {
      restoreSelection();
      document.execCommand(command, false, value);
      updateOutput();
    }

    function clearFormatting() {
      restoreSelection();
      document.execCommand('removeFormat', false, null);
      document.execCommand('formatBlock', false, 'div');
      document.execCommand('outdent');
      document.execCommand('outdent');
      updateOutput();
    }

    function updateOutput() {
      const html = document.getElementById('editor').innerHTML;
      document.getElementById('output').textContent = html;
    }

    function copyToClipboard() {
      const output = document.getElementById('output');
      const text = output.textContent;

      navigator.clipboard.writeText(text).then(() => {
        const button = document.getElementById('copyButton');
        button.textContent = "Copied!";
        setTimeout(() => {
          button.textContent = "Copy for FuseSign";
        }, 1500);
      }).catch(err => {
        alert("Failed to copy: " + err);
      });
    }

    function toggleDropdown(id) {
      document.querySelectorAll('.dropdown-content').forEach(el => {
        if (el.id !== id) el.style.display = 'none';
      });

      const menu = document.getElementById(id);
      menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    }

    function insertText(text) {
      restoreSelection();

      const selection = window.getSelection();
      if (!selection.rangeCount) return;

      const range = selection.getRangeAt(0);
      range.deleteContents();
      const node = document.createTextNode(text + ' ');
      range.insertNode(node);

      range.setStartAfter(node);
      range.setEndAfter(node);
      selection.removeAllRanges();
      selection.addRange(range);

      updateOutput();
      document.querySelectorAll('.dropdown-content').forEach(el => el.style.display = 'none');
    }

    function saveSelection() {
      const sel = window.getSelection();
      if (sel.rangeCount > 0) {
        savedRange = sel.getRangeAt(0);
      }
    }

    function restoreSelection() {
      const sel = window.getSelection();
      sel.removeAllRanges();
      if (savedRange) {
        sel.addRange(savedRange);
      }
    }

    document.getElementById('editor').addEventListener('keyup', saveSelection);
    document.getElementById('editor').addEventListener('mouseup', saveSelection);
    document.getElementById('editor').addEventListener('blur', saveSelection);
    document.getElementById('editor').addEventListener('focus', saveSelection);

    document.addEventListener('keydown', function (e) {
      const editor = document.getElementById('editor');
      if (document.activeElement !== editor) return;

      if (e.ctrlKey || e.metaKey) {
        switch (e.key.toLowerCase()) {
          case 'b':
            e.preventDefault();
            execCmd('bold');
            break;
          case 'i':
            e.preventDefault();
            execCmd('italic');
            break;
          case 'u':
            e.preventDefault();
            execCmd('underline');
            break;
        }
      }
    });

    document.addEventListener('click', function (e) {
      if (!e.target.closest('.dropdown')) {
        document.querySelectorAll('.dropdown-content').forEach(el => el.style.display = 'none');
      }
    });

    updateOutput();
  </script>
</body>
</html>
